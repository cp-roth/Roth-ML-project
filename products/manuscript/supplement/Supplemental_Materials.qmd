---
title: "Supplemental Materials"
author: Cassia Roth
date: "`r Sys.Date()`"
format:
  docx:
    toc: false
    number-sections: true
    highlight-style: github
    bibliography: ../../../assets/Mada_Bib.bib
    csl: ../../../assets/apa.csl
    suppress-bibliography: false
---
# Supplemental Materials

```{r, echo=FALSE, message=FALSE}
# Load packages
library(tidyverse) #for data processing/cleaning
library(skimr) #for nice visualization of data 
library(here) #to set paths
library(renv) #for package management
library(gtsummary) #for summary tables
library(flextable) #for nice tables
```

## Schematic of workflow

If reproducing this analysis, please run code in the following order: 1) `processingfile-v1.qmd` in the `processing-code` folder; 2) `eda-v1.qmd` in the `eda-code` folder; 3) `introanalyis-v1.qmd` in the `analysis-code` folder; 4) `fullanalysis-v1.qmd` in the `analysis-code` folder. Older versions of code in `.r` are available in the `old-code` folder. These files have not been updated since 15 August 2024.

## Data import and cleaning

The GitHub repository for this project includes all relevant materials. All discussions of data import are detailed in `processingfile-v1.qmd` in the `processing-code` folder. The original raw data, the codebook, and the processed data are available in the `data` folder.

## Data Source

In this paper, I analyze a unique dataset of 2845 recorded clinical visits to Maternidade Laranjeiras between June 1922 and May 1926. I extracted the sample from Brazil’s major obstetrics and gynecology journal in the first half of the twentieth century, the *Revista de Gynecologia e d’Obstetricia* (RGO). The RGO was associated with the country’s medical association, the National Academy of Medicine (Academia Nacional de Medicina, ANM) and the Brazilian Society of Obstetrics and Gynecology (Sociedade de Obstetricia e Gynecologia do Brasil), both based in Rio de Janeiro. The journal started in August 1907 as the *Revista de Gynecologia e D’Obstetricia do Rio de Janeiro*. In 1919, it changed to the *Revista de Gynecologia, D’Obstetricia e de Pediatria*. In 1922, it became the *Revista de Gynecologia e D’Obstetricia*.

The journal published obstetricians’ and gynecologists’ clinical observations, analyses of new surgical techniques, and ANM proceedings. Between June 1922 and May 1926, RGO also published the monthly clinical reports of all women treated at the Maternidade Laranjeiras. I was unable to locate vol. 18, nos. 4, 5, 6, 8 (1924) and vol. 20, no. 4 (1926). From the available issues, I recorded the following information, when available, for all patients: patient number, gravidity and parity, skin color, age, nationality, type of delivery (natural, interventionist, operative), maternal outcome (death, discharge, transferal to separate hospital), birth outcome (spontaneous abortion, stillbirth, live birth, or neonatal death), and the mother’s reproductive history. Gravidity refers to the total number of pregnancies a woman has, regardless of duration. Parity refers to a woman’s number of past pregnancies that reached viability and have been delivered, regardless of the number of children [@posner2013].

The journal is held at the Biblioteca Nacional (BN), the Maternidade Escola, Rio de Janeiro (ME-UFRJ), and the Biblioteca CB/A-Biomédica A, Universidade Estadual do Rio de Janeiro (UERJ), all in Rio de Janeiro, Brazil. Between January 2012 and July 2013, I manually digitized the journal by photographing each volume. Then, between January and August 2017, I manually input the data into Excel from the digital reproductions. I then converted this into a .csv file for upload into R.

## Study Measures

There are three continuous variables: maternal age, infant birth weight, and infant length. There are nine categorical variables: skin color; ancestry; parity; nationality; combined nationality; birth outcome; maternal outcome; fetal outcome; and fetal sex.

In the first round of peer review, the reviewers suggested calculating median birth weight for different immigrant groups by nationality to better justify groupings. Ball [@ball2020] found that Portuguese immigrants had worse economic opportunities in São Paulo during the same time period. Although the Portuguese immigrant experience in Rio de Janeiro was likely better due to community, merchant connection, Portuguese business owners, and job availability, I needed to better justify my nationality categorization. In the `eda-v1.qmd` file, I calculated the mean birth weight for individual nationalities and performed a t-test between Portuguese infants and infants born to all other European nationalities and Portuguese infants and infants born to White Brazilian mothers. All results were not significant at the alpha 0.05 level. Thus, I will maintain the nationality categorizations of European, Brazilian, Latin American, and Middle Eastern.

```{r}
#| label: tbl-mean
#| tbl-cap: "Mean Birthweights by Nationality"
#| echo: FALSE
table_mean <- readRDS(here::here("results", "tables", "table_nationality_stats_final.rds"))
flex_table <- as_flex_table(table_mean)
flex_table
```
```{r}
#| label: tbl-ttest
#| tbl-cap: "T-Test Results"
#| echo: FALSE
table_ttest <- readRDS(here::here("results", "tables", "table_ttest_final.rds"))
table_ttest
```

### Full Summary Table

Here is the code for the full summary table of all variables. 

```{r}
#| label: tbl-tablesupplemental
#| tbl-cap: "Supplemental Table"
#| echo: FALSE
table_supplemental <- readRDS(here::here("results", "tables", "table_supplemental_final.rds"))
flex_table <- as_flex_table(table_supplemental)
flex_table
```

## Basic Statistical Analysis

To better understand our outcome of interest, birth weight, the exploratory analysis includes the distribution of the data. Figure 1 is a histogram of the birth weight data, with the two dotted red lines marking the upper and lower limits of what the WHO now defines as normal birth weight [@worldhealthorganization2022].

```{r}
#| label: fig-schematic-1
#| fig-cap: Histogram of birth weight
#| echo: FALSE
knitr::include_graphics(here("results","figures","weight_distribution.png"))
```

Because the data are missing gestational age, birth length is less important for our analysis. Nonetheless, Figure 2 shows a histogram of the distribution of birth lengths in the sample. The red line marks the average birth length for both male and female infants (49 centimeters), which is in line with current estimates on birth length globally [@jamshed2020].

```{r}
#| label: fig-schematic-2
#| fig-cap: Histogram of birth length
#| echo: FALSE
knitr::include_graphics(here("results","figures","length_distribution.png"))
```

Figure 3 visualizes the relationship between infant weight and length. Unsurprisingly, birth weight and length are positively correlated.

```{r}
#| label: fig-schematic-3
#| fig-cap: Scatterplot of birth weight by length
#| echo: FALSE
knitr::include_graphics(here("results","figures","length_weight.png"))
```

Figure 4 visualizes the relationship of birth weight and length, stratified by sex since male infants are usually slightly heavier and longer than females [@crawford1987, @marsal1996].

```{r}
#| label: fig-schematic-4
#| fig-cap: Scatterplot of birth weight by length stratified by sex
#| echo: FALSE
knitr::include_graphics(here("results","figures","length_weight_sex.png"))
```

## Models

### Linear Models

For the basic statistical analysis, I ran three linear models to understand the relationship between maternal factors and infant birth weight. The first model is a simple linear regression with outcome variable (birth weight in grams) and exposure variable maternal ancestry (`Euro-descent`, the reference, and `Afro-descent`). There is an association between maternal skin color and infant birth weight, with Euro-descended women having infants with higher birth weights than Afro-descended women. This initial finding serves as the impetus for the rest of the models.

```{r}
#| label: tbl-table1
#| tbl-cap: "Model 1"
#| echo: FALSE
table1 <- readRDS(here::here("results", "tables", "table_fit1.rds"))
flex_table <- as_flex_table(table1)
flex_table
```

The second simple bivariate linear analysis, looks at infant birth weight as a function of maternal age on both a linear scale and age-squared with `ModifiedColor` as the main predictor variable. Neither age nor age-squared were significant. Peer reviewers asked me to include $age^2$ in the model to improve the fit. Including $age^2$ in the model did not improve the fit, and the coefficient was not significant. Despite a lack of statistical significance, the coefficients suggests that while birth weight increases with maternal age, it does so at a decreasing rate. At certain maternal age, infant birth weight begins decreasing, presenting a reverse U-shaped curve.

```{r}
#| label: tbl-table2
#| tbl-cap: "Model 2"
#| echo: FALSE
table2 <- readRDS(here::here("results", "tables", "table_fit2.rds"))
flex_table <- as_flex_table(table2)
flex_table
```

The third exploratory statistical model is a multilinear regression, looking at the relationship of maternal skin color, age, age squared, nationality, and gestational status on infant birth weight with the `ModifiedColor` variable as the main predictor variable.

```{r}
#| label: tbl-age2
#| tbl-cap: "Age-Squared"
#| echo: FALSE
table_age2 <- readRDS(here::here("results", "tables", "table_fit3.rds"))
flex_table <- as_flex_table(table_age2)
flex_table
```

Peer review suggested that I control for year-specific effects given possible periodic epidemics in infectious disease such as malaria and yellow fever and changes in real wages. I do this by including year fixed effects. The fourth model looks at the relationship between maternal skin color, age, nationality, gestational status, and year fixed effects on infant birth weight with `ModifiedColor` as the main predictor variable. Generally, differences across years are common given changes in macroeconomic conditions such as real wages and epidemic disease. The coefficient for the main predictor variable `Afro-descent` is -84, compared to -86 in the full model without year fixed effects. Thus, controlling for year-specific effects, the model provides similar coefficients for birth weight, which were highest in 1922. This result is consistent with lower birth weights due to significant inflation and increased cost of living in Rio de Janeiro from 1923 to 1925 [@lobo2024].

```{r}
#| label: tbl-table4
#| tbl-cap: "Model 4"
#| echo: FALSE
table4 <- readRDS(here::here("results", "tables", "table_fit9.rds"))
flex_table <-as_flex_table(table4)
flex_table
```

I also tested the model five times, one for each year.

```{r}
#| label: tbl-table5
#| tbl-cap: "Model 5"
#| echo: FALSE
table5 <- readRDS(here::here("results", "tables", "combined_table_years.rds"))
flex_table <-as_flex_table(table5)
flex_table
```

In every year, the coefficient for Afro-descended infants is consistently negative. However, the coefficient is statistically significant at conventional levels only for the 1923 sub-sample, in which the coefficient for infant birth weights to Afro-descended mothers was nearly 3 times the sample coefficient (-237 compared to -84). Thus, I then dropped the observations from 1923 and re-ran the model to see if the results remained robust.

```{r}
#| label: tbl-table6
#| tbl-cap: "Model 6: 1922, 1924, 1925, 1926"
#| echo: FALSE
table6 <- readRDS(here::here("results", "tables", "table_fit11.rds"))
flex_table <- as_flex_table(table6)
flex_table
```

In this sub-sample model (Model 6), the coefficient for infants born to Afro-descended mothers was both not significant and lower than in the full model (-40). However, dropping the observations from 1923 has reduced my sample size by about 25%. It appears that births from 1923 are driving the overall results. In 1922, Brazil experienced an economic crisis with a drop in coffee prices, high inflation, and a resulting fiscal emergency, which most likely affected the port city and capital of Rio de Janeiro [@fritsch1993]. It appears that economic uncertainty affected women of African descent more than those of European descent in this year. 

Additionally, these results could be due to smaller sample sizes and larger standard errors -- noise in the data. This reflects the limitations of historical data and historical research given small sample sizes.

The last exploratory model again runs a multivariate linear regression, this time using skin color as it was differentiated in the original data, or with three categories (White, Black, and Mixed Race). 

```{r}
#| label: tbl-table7
#| tbl-cap: "Model 7"
#| echo: FALSE
table7 <- readRDS(here::here("results", "tables", "table_fit8.rds"))
flex_table <- as_flex_table(table7)
flex_table
```

For all models in this study, the $(R^2)$ is small, indicating that the model does not explain much of the variance in birth weight. This is likely due to the fact that birth weight is a complex trait influenced by genetic (not related to skin color), environmental, and social factors [@leimert2020]. Yet, as Claudia Goldin and Robert A. Margo have shown for nineteenth-century Philadelphia, the inclusion of gestational age greatly improved the regression fit in their studies, demonstrating that gestational age could explain much of the variance of birth weight [@goldin1989]. Nonetheless, other scholars have shown that even though differential rates of PTB explain some of the variance in birth weight according to maternal skin color in the United States, up to 91 percent of the Black-White gap in full-term birth weight remained unexplained [@costa2004]. 

Here, I am exploring if maternal skin color is associated with lower infant birth weight during a historical time period in Rio de Janeiro, Brazil. Given my hypothesis, that the legacies of slavery affected maternal-fetal health, then maternal skin color is also probably associated with premature birth, which is correlated to infant birth weight.

All code for these models is available in the `introanalysis-v1.qmd` file.

### Logistic Models

In my introductory analysis, I further ran logistic models that estimated the relationship of maternal variables on infant birth weight as a categorical variable, in line with some studies on birth weight [@falcao2020; @nyarko2013; @paixao2021; @silva1998; @wehby2015a; @wehby2017a].

I consider `Birthweight` as the outcome of interest, but I transformed it into a categorical outcome of NBW $>2500$ g or LBW $\leq2500$ g) and fit a logistic model, using the main predictor of interest, `ModifiedColor`. These cutoffs are according to the WHO [@worldhealthorganization2022].

The first model is a simple logistic regression, with modified maternal skin color as the predictor variable.

```{r}
#| label: tbl-table5
#| tbl-cap: "Model 5"
#| echo: FALSE
table5 <- readRDS(here::here("results", "tables", "table_log1.rds"))
flex_table <- as_flex_table(table5)
flex_table
```

Model 5 demonstrates that women of African-descent had higher odds of giving birth to infants with lower birth weight than Euro-descended women (OR 1.45 [95% CI 1.07, 1.96, p-value = 0.016).

The second model is also a simple logistic regression, this time using `Color` as the predictor variable (Black, mixed race, and White).

```{r}
#| label: tbl-table6
#| tbl-cap: "Model 6"
#| echo: FALSE
table6 <- readRDS(here::here("results", "tables", "table_log2.rds"))
flex_table <- as_flex_table(table6)
flex_table
```

When using the hospital records' original skin color categories, mixed-race women had higher odds of giving birth to infants of lower birth weight (OR 1.64 [95% CI	1.17, 2.30], p-value = 0.004), but results for the infants of Black women were not significant at the alpha 0.05 level (OR 1.25 [95% CI 0.87, 1.79], p-value = 0.2).

Then, I ran two more logistic models, one with `ModifiedColor` and the other covariates `Age`, `ModifiedStatus`, `ModifiedNationality`, and one with `Color` and these same covariates. The results are below.

```{r}
#| label: tbl-table7
#| tbl-cap: "Model 7"
#| echo: FALSE
table7 <- readRDS(here::here("results", "tables", "table_log3.rds"))
flex_table <- as_flex_table(table7)
flex_table
```

```{r}
#| label: tbl-table8
#| tbl-cap: "Model 8"
#| echo: FALSE
table8 <- readRDS(here::here("results", "tables", "table_log4.rds"))
flex_table <- as_flex_table(table8)
flex_table
```

In these two models, the only significant finding is from the final logistic model, in which infants born to mixed-race mothers had 21% higher odds of being born with low birth weight compared to infants born to white mothers. The other models did not show significant results.

Best practice is to not categorize continuous variables, as this can include arbitrary cutoffs for variables that are best understood continuously [@senn2005]. Thus, I will not include these logistic regressions in the final analysis.

In the first round of peer review, the reviewers suggested that a logit analysis using stillbirth as an outcome would bring robustness to the racial disparities I highlight in the linear regression. After running a simple logistic regression with `FetalOutcome` as the predictor variable and `ModifiedColor` as the outcome, infants born to African-descended women had a 9% higher odds of having a stillbirth than Euro-descended women. However, all results were not significant [95% CI 0.82, 1.45; p-value 0.6], and thus I will not include them in the final analysis.

```{r}
#| label: tbl-table9
#| tbl-cap: "Model 9"
#| echo: FALSE
table9 <- readRDS(here::here("results", "tables", "table_log5.rds"))
flex_table <- as_flex_table(table9)
flex_table
```

## Performance Measures

Given that this study is an inferential, hypothesis-supporting approach that is exploring how specific maternal predictors affect the outcome of interest, birth weight, please see the `fullanalysis-v1.qmd` for all predictive metrics, where I applied test/train (75-25 split) and cross-validation to test performance. Model performance did not significantly improve with these additional tests. When run on testing data, most results were insignificant, given the smaller sample size.

Here I include the cross-validation results for the linear models.

```{r}
#| label: tbl-table10
#| tbl-cap: "Cross-Validation Model 1"
#| echo: FALSE
ML_cv1_metrics <- readRDS(here::here("results", "tables", "ML_cv1_metrics.rds"))
ML_cv1_metrics
```

```{r}
#| label: tbl-table11
#| tbl-cap: "Cross-Validation Model 2"
#| echo: FALSE
ML_cv2_metrics <- readRDS(here::here("results", "tables", "ML_cv2_metrics.rds"))
ML_cv2_metrics
```

```{r}
#| label: tbl-table12
#| tbl-cap: "Cross-Validation Model 3"
#| echo: FALSE
ML_cv3_metrics <- readRDS(here::here("results", "tables", "ML_cv3_metrics.rds"))
ML_cv3_metrics
```

```{r}
#| label: tbl-table13
#| tbl-cap: "Cross-Validation Model 4"
#| echo: FALSE
ML_cv4_metrics <- readRDS(here::here("results", "tables", "ML_cv4_metrics.rds"))
ML_cv4_metrics
```

The performance metrics for the logistic models are available in the `introanalysis-v1.qmd` file.

# AI Use

During the preparation of this work the author used the LLMs ChatGPT, CoPilot, and Claude in order to troubleshoot coding errors in R. After using this tool/service, the author reviewed and edited the content as needed and takes full responsibility for the content of the publication.

# References